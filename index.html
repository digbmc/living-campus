<!DOCTYPE html>
<html>
<head>
	<title>Living Campus</title>
	 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/src/leaflet-search.min.css">
   <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>
   <script
  src="https://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/dist/leaflet-search.src.min.js"></script>
   <style type="text/css">
   		#livingcampus {
   			height: 1000px;
   		}
   		.tooltip-img {
		  max-width: 200px;
		  max-height: 200px;
		  display: block;
		  margin-left: auto;
		  margin-right: auto;
		}
   </style>
</head>
<body>
	<div id="livingcampus"></div>
	<script type="text/javascript">
			var donations = $.ajax({
			url:"lc-data.geojson",
			dataType: "json",
			success:console.log("Data successfully loaded!"),
			error: function (xhr) {
				alert(xhr.statusText)
			}
		})

		$.when(donations).done(function() {


		var mymap = L.map('livingcampus').setView([40.027, -75.315], 16);
		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    	maxZoom: 20,
    	id: 'mapbox.streets',
    	accessToken: 'pk.eyJ1IjoiYXBlYWtlciIsImEiOiJjamxxdDBzYXoyam52M3B0NXJzazZ3b3Y2In0.0Pd_m3s30duVpgLPy4foqA'
		}).addTo(mymap);

		var objIcon = L.icon({
				iconUrl: 'lantern_0.jpg',
				iconSize:     [30, 30], // size of the icon
	    		iconAnchor:   [15, 0], // point of the icon which will correspond to marker's location
	    		popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
			});

		var treeIcon = L.icon({
				iconUrl: 'tree_icon.png',
				iconSize: [30, 30],
				iconAnchor: [15, 15],
				popupAnchor: [0, 0]
			});

		var donatedObjectsLayer = L.geoJSON(donations.responseJSON, {
			filter: function(feature, layer)
			{
				if (feature.properties.icon == "object"){
					return feature.properties.icon;
				}
			},
			onEachFeature: function(feature, layer){
				var p = layer.feature.properties;
				p.index = p.item + " | " + p.donor_id + " | " + p.dedi_id + " | " + p.inscription;
				//only try to display image if there's an image source
				if (p.img_src != ''){
					var img = '<img class ="tooltip-img" src = "images/' + p.img_src + '" >'
				} else img = '<img style="display:none">';
				layer.bindPopup(img + '<h1>Dedicated to '+feature.properties.dedi_id+'</h1><h2>Given by ' + feature.properties.donor_id+'</h2>'  + feature.geometry.coordinates),
				layer.setIcon(objIcon)
			}

		}).addTo(mymap);

		var donatedTreesLayer = L.geoJSON(donations.responseJSON, {
				filter: function(feature, layer) {
				if (feature.properties.icon == "tree"){
			return feature.properties.icon;
	}
},
				onEachFeature: function(feature, layer) {
					var q = layer.feature.properties;
					q.index = q.item + " | " + q.donor_id + " | " + q.dedi_id + " | " + q.inscription;
					//only try to display image if there's an image source
					if (q.img_src != ''){
						var img = '<img class ="tooltip-img" src = "images/' + q.img_src + '" >'
					} else img = '<img style="display:none">';
					layer.bindPopup(img + '<h1>' + feature.properties.item +  '</h1><h2>Dedicated to ' + feature.properties.dedi_id + '</h2><h2>Given by ' + feature.properties.donor_id + '</h2>'),
								layer.setIcon(treeIcon)
				}
		}).addTo(mymap);

		var overlayMaps = {
			"Objects": donatedObjectsLayer,
			"Trees": donatedTreesLayer
		};

		L.control.layers(null, overlayMaps).addTo(mymap);

		var mapLayers = L.layerGroup()
			.addLayer(donatedTreesLayer)
			.addLayer(donatedObjectsLayer)
			.addTo(mymap);


		var controlSearch = new L.Control.Search({
		    position:'topleft',    // where do you want the search bar?
		    layer: mapLayers,  // name of the layer
		    propertyName: 'index',
		    initial: false,
		    zoom: 20,        // set zoom to found location when searched
		    marker: false,
		    textPlaceholder: 'search...' // placeholder while nothing is searched
		  });


  mymap.addControl(controlSearch)

});
	</script>
</body>
</html>
